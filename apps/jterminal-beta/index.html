<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Jtermnial</title>
  <style>
    /* Basic reset */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; width: 100%; background: #000; color: #0f0; font-family: monospace; }
    #terminal {
      display: flex;
      flex-direction: column;
      height: 100%;
      padding: 10px;
      overflow: hidden;
    }
    #output {
      flex: 1;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    #input-line {
      display: flex;
    }
    #prompt {
      flex-shrink: 0;
    }
    #cmdline {
      background: transparent;
      border: none;
      color: inherit;
      flex: 1;
      outline: none;
      font-family: inherit;
      font-size: inherit;
    }
    a { color: #0f0; text-decoration: underline; }
  </style>
</head>
<body>
  <div id="terminal">
    <div id="output"></div>
    <div id="input-line">
      <span id="prompt">juser@jtermnial:~$&nbsp;</span>
      <input type="text" id="cmdline" autofocus autocomplete="off" />
    </div>
  </div>

  <script>
    // Virtual filesystem:
    const FS = {
      '/': {
        type: 'dir',
        children: {
          'home': { type: 'dir', children: {
            'README.txt': { type: 'file', content:
`Welcome to Jtermnial!
Type 'help' to see available commands.` }
          }},
          'etc': { type: 'dir', children: {} },
          'var': { type: 'dir', children: {} }
        }
      }
    };

    let cwd = ['/']; // current working directory path as array

    const outputEl = document.getElementById('output');
    const cmdlineEl = document.getElementById('cmdline');
    const promptEl = document.getElementById('prompt');

    function getNode(pathArr) {
      let node = FS['/'];
      for (let i = 1; i < pathArr.length; i++) {
        const part = pathArr[i];
        if (!node.children[part]) return null;
        node = node.children[part];
      }
      return node;
    }

    function resolvePath(arg) {
      let parts = arg.startsWith('/') ? [''] : cwd.slice();
      arg.split('/').forEach(p => {
        if (p === '' || p === '.') return;
        if (p === '..') {
          if (parts.length > 1) parts.pop();
        } else {
          parts.push(p);
        }
      });
      if (parts.length === 0) parts = [''];
      return parts;
    }

    function pathToString(pathArr) {
      return pathArr.join('/') || '/';
    }

    function listDir(pathArr) {
      const node = getNode(pathArr);
      if (!node || node.type !== 'dir') return null;
      return Object.keys(node.children);
    }

    function print(text = '') {
      outputEl.innerHTML += text.replace(/&/g,'&amp;').replace(/</g,'&lt;') + '\n';
      outputEl.scrollTop = outputEl.scrollHeight;
    }

    function runCommand(input) {
      if (!input.trim()) return;
      print(`<span style="color:#0a0;">${promptEl.textContent}${input}</span>`);
      const [cmd, ...args] = input.split(/\s+/);
      switch (cmd) {
        case 'help':
          print(`Available commands:
  help        - Show this help
  ls [path]   - List directory contents
  pwd         - Print working directory
  cd [path]   - Change directory
  echo [...]  - Echo arguments
  date        - Show current date/time
  clear       - Clear the screen
  cat <file>  - Show file contents`);
          break;
        case 'ls': {
          const target = args[0] ? resolvePath(args[0]) : cwd;
          const list = listDir(target);
          if (list) print(list.join('  '));
          else print(`ls: cannot access '${args[0] || '.'}': No such directory`);
          break;
        }
        case 'pwd':
          print(pathToString(cwd));
          break;
        case 'cd': {
          const target = args[0] ? resolvePath(args[0]) : [''];
          const node = getNode(target);
          if (node && node.type === 'dir') {
            cwd = target;
            promptEl.textContent = `juser@jtermnial:${pathToString(cwd)}$ `;
          } else {
            print(`cd: no such file or directory: ${args[0]}`);
          }
          break;
        }
        case 'echo':
          print(args.join(' '));
          break;
        case 'date':
          print(new Date().toString());
          break;
        case 'clear':
          outputEl.innerHTML = '';
          break;
        case 'cat': {
          if (!args[0]) { print('cat: missing operand'); break; }
          const target = resolvePath(args[0]);
          const node = getNode(target);
          if (node && node.type === 'file') {
            print(node.content);
          } else {
            print(`cat: ${args[0]}: No such file`);
          }
          break;
        }
        default:
          print(`${cmd}: command not found`);
      }
    }

    cmdlineEl.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        const input = cmdlineEl.value;
        runCommand(input);
        cmdlineEl.value = '';
      }
    });

    // paint initial welcome
    print('Jtermnial starting...\nType \'help\' for commands.\n');
  </script>
</body>
</html>
