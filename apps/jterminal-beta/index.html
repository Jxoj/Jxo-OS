<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Jtermnial</title>
  <style>
    /* Basic reset */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; width: 100%; background: #fff; color: #000; font-family: monospace; }
    #terminal {
      display: flex;
      flex-direction: column;
      height: 100%;
      padding: 10px;
      overflow: hidden;
    }
    #output {
      flex: 1;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    #input-line {
      display: flex;
    }
    #prompt {
      flex-shrink: 0;
    }
    #cmdline {
      background: transparent;
      border: none;
      color: inherit;
      flex: 1;
      outline: none;
      font-family: inherit;
      font-size: inherit;
    }
    a { color: #000; text-decoration: underline; }
  </style>
</head>
<body>
  <div id="terminal">
    <div id="output"></div>
    <div id="input-line">
      <span id="prompt">juser@jtermnial:~$ </span>
      <input type="text" id="cmdline" autofocus autocomplete="off" />
    </div>
  </div>

  <script>
    // Virtual filesystem root
    const FS = {
      type: 'dir',
      children: {
        home: {
          type: 'dir',
          children: {}
        }
      }
    };

    let cwd = ['home'];

    const outputEl = document.getElementById('output');
    const cmdlineEl = document.getElementById('cmdline');
    const promptEl = document.getElementById('prompt');

    function print(text='') {
      outputEl.innerHTML += text.replace(/&/g,'&amp;').replace(/</g,'&lt;') + '\n';
      outputEl.scrollTop = outputEl.scrollHeight;
    }

    function getNode(pathArr) {
      let node = FS;
      for (let part of pathArr) {
        if (node.type !== 'dir' || !(part in node.children)) return null;
        node = node.children[part];
      }
      return node;
    }

    function resolvePath(arg) {
      let parts = arg.startsWith('/') ? [] : [...cwd];
      for (let p of arg.split('/')) {
        if (!p || p === '.') continue;
        if (p === '..') {
          if (parts.length) parts.pop();
        } else {
          parts.push(p);
        }
      }
      return parts;
    }

    function pathString(pathArr) {
      return '/' + pathArr.join('/');
    }

    function listDir(pathArr) {
      const node = getNode(pathArr);
      return node && node.type === 'dir'
        ? Object.keys(node.children)
        : null;
    }

    function runCommand(input) {
      if (!input.trim()) return;
      print(`<span style="color:#333;">${promptEl.textContent}${input}</span>`);
      const [cmd, ...args] = input.trim().split(/\s+/);
      switch (cmd) {
        case 'help':
          print(`Available commands:
  help        - Show this help message
  wget URL    - Simulate downloading a file
  nano FILE   - Simulate editing/creating a file
  cd [PATH]   - Change directory
  mkdir NAME  - Create a new directory
  ls [PATH]   - List directory contents
  clear       - Clear the terminal screen`);
          break;

        case 'wget':
          if (!args[0]) {
            print('wget: missing URL');
          } else {
            const url = args[0];
            const file = url.split('/').pop() || 'download';
            print(`--2025-06-22  Downloading: ${url}`);
            print(`Saving to: ${file}`);
            // create empty file in cwd
            const dir = getNode(cwd);
            dir.children[file] = { type: 'file', content: '' };
          }
          break;

        case 'nano':
          if (!args[0]) {
            print('nano: missing file operand');
          } else {
            const file = args[0];
            const dir = getNode(cwd);
            if (!(file in dir.children)) {
              dir.children[file] = { type: 'file', content: '' };
            }
            print(`Opened ${file} for editing (simulation)`);
          }
          break;

        case 'cd':
          const target = args[0] ? resolvePath(args[0]) : ['home'];
          if (getNode(target)?.type === 'dir') {
            cwd = target;
            promptEl.textContent = `juser@jtermnial:${pathString(cwd)}$ `;
          } else {
            print(`cd: no such file or directory: ${args[0]}`);
          }
          break;

        case 'mkdir':
          if (!args[0]) {
            print('mkdir: missing operand');
          } else {
            const name = args[0];
            const dir = getNode(cwd);
            if (dir.children[name]) {
              print(`mkdir: cannot create directory ‘${name}’: File exists`);
            } else {
              dir.children[name] = { type: 'dir', children: {} };
            }
          }
          break;

        case 'ls': {
          const targetPath = args[0] ? resolvePath(args[0]) : cwd;
          const list = listDir(targetPath);
          if (list) print(list.join('  '));
          else print(`ls: cannot access '${args[0] || '.'}': No such directory`);
          break;
        }

        case 'clear':
          outputEl.innerHTML = '';
          break;

        default:
          print(`${cmd}: command not found`);
      }
    }

    cmdlineEl.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        const val = cmdlineEl.value;
        runCommand(val);
        cmdlineEl.value = '';
      }
    });

    // Initial banner
    print('Type \'help\' for commands.');
  </script>
</body>
</html>
